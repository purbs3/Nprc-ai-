import{r as c,j as e}from"./index-DIzydVhA.js";import{X as D,I as M,a as L,C as E,H as U,P as z,M as F,D as $}from"./IconComponents-CQvE_25E.js";import{a as H,b as O}from"./geminiService-D3ylRyWO.js";import{L as J}from"./LoadingSpinner-BQulzYF6.js";import{g as S,s as B}from"./telehealthService-BrJQz6d6.js";import{C as G}from"./ChatInterface-B0i08LHa.js";import"./html-D3brqi0s.js";const k=["Shoulder","Knee","Elbow","Wrist","Ankle","Neck","Hip"],W=({isOpen:i,onClose:x,onComplete:d})=>{const[r,t]=c.useState("select"),[m,p]=c.useState(k[0]),[a,g]=c.useState(null),[b,f]=c.useState(null),[o,l]=c.useState(""),[s,u]=c.useState(null),h=c.useRef(null),y=c.useRef(null);c.useEffect(()=>{let n=null;const j=async()=>{try{n=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}}),h.current&&(h.current.srcObject=n)}catch(N){console.error("Error accessing camera:",N),u("Could not access camera. Please check permissions and try again."),t("select")}},v=()=>{n&&n.getTracks().forEach(N=>N.stop()),h.current&&(h.current.srcObject=null)};return i&&(r==="capture_start"||r==="capture_end")&&j(),()=>{v()}},[i,r]);const I=()=>{if(h.current&&y.current){const n=y.current,j=h.current;n.width=j.videoWidth,n.height=j.videoHeight;const v=n.getContext("2d");v==null||v.drawImage(j,0,0,n.width,n.height);const N=n.toDataURL("image/jpeg");r==="capture_start"?(g(N),t("review_start")):r==="capture_end"&&(f(N),t("review_end"))}},A=async()=>{if(!(!a||!b)){t("analyzing"),u(null);try{const n={inlineData:{mimeType:"image/jpeg",data:a.split(",")[1]}},j={inlineData:{mimeType:"image/jpeg",data:b.split(",")[1]}},v={text:`Please analyze the range of motion for the ${m} based on these two images. The first is the starting position, and the second is the final position. Provide an estimated range in degrees, comment on the mobility, and suggest one or two simple exercises. Format the response in markdown.`},_=await H({history:[{role:"user",parts:[n,j,v]}],type:"rom_analysis"});let C="";for await(const P of _)C+=P.text,l(C);t("result")}catch(n){console.error("Analysis failed:",n),u("Sorry, the analysis could not be completed. The AI service may be unavailable."),t("final_review")}}},T=()=>{const n={id:`rom-user-${Date.now()}`,role:"user",content:`I performed a range of motion check for my ${m}.`,imageUrls:[a,b],images:[{mimeType:"image/jpeg",data:a.split(",")[1]},{mimeType:"image/jpeg",data:b.split(",")[1]}]},j={id:`rom-model-${Date.now()}`,role:"model",content:o};d([n,j]),w()},w=()=>{t("select"),g(null),f(null),l(""),u(null),x()};if(!i)return null;const R=()=>{if(s&&r!=="final_review")return e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-400 mb-4",children:s}),e.jsx("button",{onClick:()=>{u(null),t("select")},className:"bg-cyan-500 text-white px-4 py-2 rounded-lg hover:bg-cyan-400",children:"Try Again"})]});switch(r){case"select":return e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Range of Motion Check"}),e.jsx("p",{className:"text-slate-400 mb-6",children:"Select the joint you want to check. You will be guided to take two pictures using your camera."}),e.jsx("label",{htmlFor:"joint-select",className:"block text-slate-300 mb-2",children:"Select Joint"}),e.jsx("select",{id:"joint-select",value:m,onChange:n=>p(n.target.value),className:"w-full bg-slate-700 text-slate-200 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-cyan-500",children:k.map(n=>e.jsx("option",{value:n,children:n},n))}),e.jsx("button",{onClick:()=>t("capture_start"),className:"w-full mt-6 bg-cyan-500 text-white py-3 rounded-lg font-semibold hover:bg-cyan-400",children:"Start"})]});case"capture_start":case"capture_end":return e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:r==="capture_start"?"Step 1: Capture Start Position":"Step 2: Capture End Position"}),e.jsx("p",{className:"text-slate-400 mb-4 text-sm",children:r==="capture_start"?`Position your ${m} in a neutral, resting position.`:`Now, move your ${m} through its full range of motion.`}),e.jsx("div",{className:"bg-slate-900 rounded-lg overflow-hidden aspect-video mb-4 border border-slate-600",children:e.jsx("video",{ref:h,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"})}),e.jsx("button",{onClick:I,className:"w-full bg-cyan-500 text-white py-3 rounded-lg font-semibold hover:bg-cyan-400",children:"Capture"})]});case"review_start":return e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Review Start Position"}),e.jsx("p",{className:"text-slate-400 mb-4 text-sm",children:"Are you happy with this image? This should be your joint in a neutral, resting position."}),e.jsx("div",{className:"bg-slate-900 rounded-lg overflow-hidden aspect-video mb-4 border border-slate-600",children:e.jsx("img",{src:a,alt:"Start position",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsx("button",{onClick:()=>{g(null),t("capture_start")},className:"w-full bg-slate-600 text-white py-3 rounded-lg font-semibold hover:bg-slate-500",children:"Retry"}),e.jsx("button",{onClick:()=>t("capture_end"),className:"w-full bg-cyan-500 text-white py-3 rounded-lg font-semibold hover:bg-cyan-400",children:"Continue"})]})]});case"review_end":return e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Review End Position"}),e.jsx("p",{className:"text-slate-400 mb-4 text-sm",children:"Are you happy with this image? This should be your joint at its full range of motion."}),e.jsx("div",{className:"bg-slate-900 rounded-lg overflow-hidden aspect-video mb-4 border border-slate-600",children:e.jsx("img",{src:b,alt:"End position",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsx("button",{onClick:()=>{f(null),t("capture_end")},className:"w-full bg-slate-600 text-white py-3 rounded-lg font-semibold hover:bg-slate-500",children:"Retry"}),e.jsx("button",{onClick:()=>t("final_review"),className:"w-full bg-cyan-500 text-white py-3 rounded-lg font-semibold hover:bg-cyan-400",children:"Continue"})]})]});case"final_review":return e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Review Both Positions"}),e.jsx("p",{className:"text-slate-400 mb-4 text-sm",children:"Confirm your start and end positions before analysis."}),s&&e.jsx("p",{className:"text-red-400 text-sm mb-4",children:s}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-center mb-1 text-slate-300",children:"Start"}),e.jsx("img",{src:a,alt:"Start position",className:"w-full h-full object-cover rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-center mb-1 text-slate-300",children:"End"}),e.jsx("img",{src:b,alt:"End position",className:"w-full h-full object-cover rounded-lg"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:A,className:"w-full bg-cyan-500 text-white py-3 rounded-lg font-semibold hover:bg-cyan-400",children:"Analyze"}),e.jsx("button",{onClick:()=>{f(null),t("capture_end")},className:"w-full bg-slate-600 text-white py-2 rounded-lg font-semibold hover:bg-slate-500",children:"Retry End Position"}),e.jsx("button",{onClick:()=>{g(null),f(null),t("capture_start")},className:"w-full text-slate-400 text-sm py-1 hover:text-white transition-colors",children:"Start Over"})]})]});case"analyzing":return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{}),e.jsx("p",{className:"mt-4 text-slate-300",children:"Analyzing your movement... Please wait."})]});case"result":return e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Analysis Result"}),e.jsx("div",{className:"max-h-64 overflow-y-auto bg-slate-900 p-4 rounded-lg prose prose-invert prose-sm prose-p:my-1",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:o.replace(/\n/g,"<br />")}})}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{onClick:w,className:"w-full bg-slate-600 text-white py-3 rounded-lg font-semibold hover:bg-slate-500",children:"Discard"}),e.jsx("button",{onClick:T,className:"w-full bg-cyan-500 text-white py-3 rounded-lg font-semibold hover:bg-cyan-400",children:"Add to Chat"})]})]})}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-xl shadow-2xl w-full max-w-lg m-4 relative p-8",children:[e.jsx("button",{onClick:w,className:"absolute top-4 right-4 text-slate-400 hover:text-white","aria-label":"Close modal",children:e.jsx(D,{className:"h-6 w-6"})}),R(),e.jsx("canvas",{ref:y,className:"hidden"})]})})};function X(i){return new Promise((x,d)=>{const r=new FileReader;r.readAsDataURL(i),r.onload=()=>{const m=r.result.split(",")[1];x(m)},r.onerror=t=>d(t)})}const K=()=>{const[i,x]=c.useState(null),[d,r]=c.useState(!1),[t,m]=c.useState(""),[p,a]=c.useState(""),g=c.useRef(null),b=l=>{var u;const s=(u=l.target.files)==null?void 0:u[0];s&&(x({file:s,previewUrl:URL.createObjectURL(s)}),m(""),a("")),l.target.value=""},f=async()=>{if(i){r(!0),m(""),a("");try{const l=await X(i.file),s=await O(l,i.file.type);let u="";for await(const h of s)u+=h.text,m(u)}catch(l){a("An error occurred during analysis. The AI service may be unavailable."),console.error("Analysis error:",l)}finally{r(!1)}}},o=l=>({__html:l.replace(/\n/g,"<br />").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")});return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg-slate-800 p-8 rounded-xl border border-slate-700 animate-fadeIn",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Posture Analysis Tool"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"border-2 border-dashed border-slate-600 rounded-lg p-6 text-center cursor-pointer hover:border-cyan-500 transition-colors",onClick:()=>{var l;return(l=g.current)==null?void 0:l.click()},children:[e.jsx("input",{type:"file",ref:g,onChange:b,accept:"image/*",className:"hidden"}),e.jsx(M,{className:"h-12 w-12 mx-auto text-slate-400"}),e.jsx("p",{className:"mt-2 text-slate-300",children:i?"Click to change image":"Click to upload an image"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Side profile or front view recommended"})]}),i&&e.jsxs("div",{className:"mt-4 relative",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Image Preview:"}),e.jsx("img",{src:i.previewUrl,alt:"Posture preview",className:"w-full rounded-lg"}),e.jsx("button",{onClick:()=>x(null),className:"absolute -top-2 -right-2 bg-slate-600 text-white rounded-full p-0.5 hover:bg-slate-500","aria-label":"Remove image",children:e.jsx(L,{className:"h-6 w-6"})})]}),e.jsx("button",{onClick:f,disabled:!i||d,className:"w-full mt-6 bg-cyan-500 text-white py-3 rounded-lg font-semibold hover:bg-cyan-400 disabled:bg-slate-600 disabled:cursor-not-allowed",children:d?"Analyzing...":"Analyze Posture"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2 text-lg",children:"AI Analysis Report"}),e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg min-h-[400px] border border-slate-700",children:[d&&e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400"})}),p&&e.jsx("p",{className:"text-red-400",children:p}),t&&e.jsx("div",{className:"prose prose-slate prose-invert",dangerouslySetInnerHTML:o(t)}),!d&&!t&&!p&&e.jsx("p",{className:"text-slate-400 text-center pt-16",children:'Upload an image and click "Analyze Posture" to see the report here.'})]})]})]})]})})},Y=()=>e.jsxs("div",{className:"bg-slate-800 p-8 rounded-xl border border-slate-700 animate-fadeIn text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Gait & Motion Analysis"}),e.jsx("p",{className:"text-slate-400",children:"This feature is currently under development."}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Soon, you'll be able to upload videos to receive detailed gait and movement analysis reports."})]}),Z=({clinicianId:i})=>{const[x,d]=c.useState([]),[r,t]=c.useState(!0);c.useEffect(()=>{(async()=>{t(!0);const s=(await S()).filter(u=>u.clinicianId===i);d(s),t(!1)})()},[i]);const m=async(o,l)=>{const u=(await S()).map(h=>h.id===o?{...h,status:l}:h);await B(u),d(h=>h.map(y=>y.id===o?{...y,status:l}:y))},p=o=>{switch(o){case"Scheduled":return"bg-blue-500/20 text-blue-300";case"Completed":return"bg-green-500/20 text-green-300";case"Cancelled":return"bg-red-500/20 text-red-300"}},a=new Date,g=x.filter(o=>new Date(o.date)>=a).sort((o,l)=>new Date(o.date).getTime()-new Date(l.date).getTime()),b=x.filter(o=>new Date(o.date)<a).sort((o,l)=>new Date(l.date).getTime()-new Date(o.date).getTime()),f=({title:o,sessionList:l})=>e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-cyan-400 mb-3 text-lg",children:o}),l.length>0?e.jsx("div",{className:"space-y-4",children:l.map(s=>e.jsxs("div",{className:"bg-slate-700/50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:s.patientName}),e.jsxs("p",{className:"text-sm text-slate-300",children:[new Date(s.date).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",timeZone:"UTC"})," at ",s.time]})]}),e.jsxs("div",{className:"mt-3 sm:mt-0 flex items-center gap-4",children:[e.jsx("span",{className:`text-xs font-semibold px-2 py-1 rounded-full ${p(s.status)}`,children:s.status}),s.status==="Scheduled"&&e.jsx("button",{className:"bg-cyan-500 text-white px-3 py-1.5 rounded-lg text-sm font-semibold hover:bg-cyan-400",children:"Join Call"})]})]}),s.notes&&e.jsxs("p",{className:"text-xs text-slate-400 mt-2 bg-slate-900/40 p-2 rounded",children:["Notes: ",s.notes]}),e.jsxs("div",{className:"mt-2 text-right",children:[e.jsx("button",{onClick:()=>m(s.id,"Completed"),className:"text-xs text-green-400 hover:text-green-300 disabled:opacity-50",disabled:s.status==="Completed",children:"Mark as Complete"}),e.jsx("span",{className:"text-slate-500 mx-2",children:"|"}),e.jsx("button",{onClick:()=>m(s.id,"Cancelled"),className:"text-xs text-red-400 hover:text-red-300 disabled:opacity-50",disabled:s.status==="Cancelled",children:"Cancel"})]})]},s.id))}):e.jsxs("p",{className:"text-slate-400 text-sm",children:["No ",o.toLowerCase()," sessions found."]})]});return e.jsxs("div",{className:"bg-slate-800 p-8 rounded-xl border border-slate-700 animate-fadeIn",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"My Telehealth Portal"}),r?e.jsx("p",{className:"text-slate-400",children:"Loading your schedule..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsx(f,{title:"Upcoming",sessionList:g}),e.jsx(f,{title:"Past",sessionList:b})]})]})},le=({clinician:i})=>{var p;const[x,d]=c.useState(null),r=[{id:"telehealth",name:"Telehealth Portal",icon:E,component:e.jsx(Z,{clinicianId:i.id})},{id:"chat",name:"AI Assistant",icon:U,component:e.jsx(G,{userType:"clinician"})},{id:"posture",name:"Posture Analysis",icon:z,component:e.jsx(K,{})},{id:"rom",name:"Range of Motion Analysis",icon:F,component:null},{id:"gait",name:"Gait Analysis",icon:$,component:e.jsx(Y,{})}],t=(p=r.find(a=>a.id===x))==null?void 0:p.component,m=a=>{d(a==="rom"?"rom_modal":a)};return e.jsxs("div",{className:"container mx-auto px-6 py-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:"Clinician Dashboard"}),e.jsxs("p",{className:"text-slate-400 mb-8",children:["Welcome, ",i.username,". Access your AI-powered analysis tools."]}),x&&x!=="rom_modal"?e.jsxs("div",{children:[e.jsx("button",{onClick:()=>d(null),className:"mb-8 text-cyan-400 hover:text-cyan-300 font-semibold",children:"â† Back to All Tools"}),t]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:r.map(a=>{const g=a.icon;return e.jsxs("button",{onClick:()=>m(a.id),className:"bg-slate-800 p-8 rounded-xl border border-slate-700 transform transition-all hover:-translate-y-2 hover:shadow-cyan-500/10 hover:border-cyan-500 text-left",children:[e.jsx("div",{className:"bg-slate-700/50 h-12 w-12 rounded-lg flex items-center justify-center mb-6",children:e.jsx(g,{className:"h-6 w-6 text-cyan-400"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:a.name})]},a.id)})}),e.jsx(W,{isOpen:x==="rom_modal",onClose:()=>d(null),onComplete:a=>{console.log("ROM analysis complete:",a),alert("Range of Motion analysis has been completed.")}})]})};export{le as default};
